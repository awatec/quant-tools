name: Claude Code Automation
on:
issues:
types: [opened, edited]

permissions:
contents: write
pull-requests: write
issues: write

jobs:
process-claude-code:
if: contains(github.event.issue.title, â€˜[CLAUDE-CODE]â€™)
runs-on: ubuntu-latest

```
steps:
  - name: Checkout repository
    uses: actions/checkout@v4
    with:
      token: ${{ secrets.GITHUB_TOKEN }}
      
  - name: Parse Issue Content
    id: parse
    run: |
      # Issueç•ªå·å–å¾—
      echo "issue_number=${{ github.event.issue.number }}" >> $GITHUB_OUTPUT
      
      # Issueæœ¬æ–‡ã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±ã‚’æŠ½å‡º
      issue_body="${{ github.event.issue.body }}"
      
      # ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚’æŠ½å‡º (FILE_PATH: ã§å§‹ã¾ã‚‹è¡Œ)
      file_path=$(echo "$issue_body" | grep "^FILE_PATH:" | cut -d' ' -f2-)
      echo "file_path=${file_path}" >> $GITHUB_OUTPUT
      
      # ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æŠ½å‡º
      commit_msg=$(echo "$issue_body" | grep "^COMMIT_MSG:" | cut -d' ' -f2- || echo "Claude auto-implementation")
      echo "commit_msg=${commit_msg}" >> $GITHUB_OUTPUT
      
      # ã‚³ãƒ¼ãƒ‰å†…å®¹ã‚’æŠ½å‡º (```ã®é–“)
      echo "Extracting code content..."
      
  - name: Extract Code Content
    run: |
      # Issueæœ¬æ–‡ã‹ã‚‰ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã‚’æŠ½å‡º
      issue_body="${{ github.event.issue.body }}"
      
      # ```ã§å›²ã¾ã‚ŒãŸéƒ¨åˆ†ã‚’æŠ½å‡º
      echo "$issue_body" | sed -n '/```/,/```/p' | sed '1d;$d' > code_content.tmp
      
      # ãƒ•ã‚¡ã‚¤ãƒ«ãŒç©ºã§ãªã„ã“ã¨ã‚’ç¢ºèª
      if [ -s code_content.tmp ]; then
        echo "Code content extracted successfully"
        head -5 code_content.tmp
      else
        echo "No code content found"
        exit 1
      fi
      
  - name: Create/Update File
    run: |
      file_path="${{ steps.parse.outputs.file_path }}"
      
      if [ -z "$file_path" ]; then
        echo "FILE_PATH not specified in issue"
        exit 1
      fi
      
      # ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ
      mkdir -p $(dirname "$file_path")
      
      # ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
      cp code_content.tmp "$file_path"
      
      echo "Created file: $file_path"
      
  - name: Run Tests (if applicable)
    run: |
      # Pythonãƒ•ã‚¡ã‚¤ãƒ«ã®å ´åˆã€åŸºæœ¬ãƒã‚§ãƒƒã‚¯
      file_path="${{ steps.parse.outputs.file_path }}"
      
      if [[ "$file_path" == *.py ]]; then
        echo "Checking Python syntax..."
        python -m py_compile "$file_path" || echo "Syntax check failed"
      fi
      
  - name: Create Pull Request
    uses: peter-evans/create-pull-request@v5
    with:
      token: ${{ secrets.GITHUB_TOKEN }}
      commit-message: "${{ steps.parse.outputs.commit_msg }}"
      title: "ğŸ¤– Claude Auto: ${{ github.event.issue.title }}"
      body: |
        ## Claudeè‡ªå‹•å®Ÿè£…
        
        **å…ƒIssue**: #${{ steps.parse.outputs.issue_number }}
        **ãƒ•ã‚¡ã‚¤ãƒ«**: `${{ steps.parse.outputs.file_path }}`
        
        ### å¤‰æ›´å†…å®¹
        - ClaudeãŒç”Ÿæˆã—ãŸã‚³ãƒ¼ãƒ‰ã‚’è‡ªå‹•å®Ÿè£…
        
        ### æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—  
        1. âœ… GitHub Actionsãƒ†ã‚¹ãƒˆçµæœç¢ºèª
        2. âœ… ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
        3. âœ… Mergeï¼ˆå•é¡Œãªã‘ã‚Œã°ï¼‰
        
        ---
        *This PR was automatically created by Claude automation system*
      branch: claude-auto-${{ steps.parse.outputs.issue_number }}
      delete-branch: true
      
  - name: Comment on Issue
    uses: actions/github-script@v6
    with:
      script: |
        github.rest.issues.createComment({
          issue_number: context.issue.number,
          owner: context.repo.owner,
          repo: context.repo.repo,
          body: 'ğŸš€ **è‡ªå‹•PRä½œæˆå®Œäº†ï¼**\n\nPull Requestã‚’ä½œæˆã—ã¾ã—ãŸã€‚GitHub Actionsã§ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œä¸­ã§ã™...\n\næ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—: PRç¢ºèªâ†’æ‰¿èªâ†’Merge'
        });
```
